#!/bin/bash

old_password=$(cat /credentials/password.txt | awk 'NR==2' |awk -F ":" '{print $2}' )
new_password=$(pwgen -Aycns -r "@&-_|%'\"\\\/\`;=+<>,.(){}[]:$~^*" 8 1)

systemctl restart mysqld

{% if not remote %}
mysqladmin -uroot -p${old_password} -h localhost password $new_password
{% if mysqlver == '5.6' or mysqlver == '5.5' %}
mysqladmin -uroot -p${old_password} -h 127.0.0.1 password $new_password
mysqladmin -uroot -p${old_password} -h ::1 password $new_password
{% endif %}
{% else  %}
mysqladmin -uroot -p${old_password} -h @ password $new_password
{% endif %}

sed -i 's/$old_password/$new_password/' /credentials/password.txt

{% if remote_user == 'websoft9' %}}
userdel -rf websoft9      
rm -rf /var/db/sudo/lectured/websoft9  
{%endif%}}

sed -i "s/\/root\/init.sh//" /etc/rc.local

rm -rf /root/init.sh

